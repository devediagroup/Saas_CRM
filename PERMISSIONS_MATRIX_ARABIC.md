# ูุตูููุฉ ุงูุตูุงุญูุงุช ุงููุญุฏุซุฉ - EchoOps Real Estate CRM

## ุงูููุฎุต ุงูุชูููุฐู

ุชู ุชุญุฏูุซ ูุธุงู ุงูุตูุงุญูุงุช ููุชูุงูู ูุน ุงูุชูุฑูุฑ ุงููุฑููุ ูููุงู ููุตูููุฉ ุงูุตูุงุญูุงุช ุงูุชูุตูููุฉ ุงููุทููุจุฉ ูุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช ูุดุฑูุงุช ุงูุชุณููู ุงูุนูุงุฑู.

## ๐ข ูููู ุงูุฃุฏูุงุฑ (Role Structure)

### 1. Super Admin (ุงููุณุคูู ุงูุนุงู)
- **ุงููุตู**: ุชุญูู ูุงูู ูู ุฌููุน ุฌูุงูุจ ุงููุธุงู ุนุจุฑ ุฌููุน ุงูุดุฑูุงุช
- **ุงููุทุงู**: ุนุจุฑ ุฌููุน ุงูุดุฑูุงุช (Cross-tenant)
- **ุงูุตูุงุญูุงุช**: ุฌููุน ุงูุตูุงุญูุงุช (`*.*`)

### 2. Company Admin (ูุณุคูู ุงูุดุฑูุฉ)
- **ุงููุตู**: ูุณุคูู ุฑุฆูุณู ุนู ุฅุฏุงุฑุฉ ุงููุธุงู ุฏุงุฎู ุดุฑูุชู
- **ุงููุทุงู**: ุดุฑูุชู ููุท (Single-tenant)
- **ุงูุตูุงุญูุงุช**: ุฅุฏุงุฑูุฉ ูุงููุฉ ุนูู ุจูุงูุงุช ุดุฑูุชู

### 3. Sales Manager (ูุฏูุฑ ุงููุจูุนุงุช)
- **ุงููุตู**: ุฅุดุฑุงู ุนูู ูุฑูู ูููุงุก ุงููุจูุนุงุช
- **ุงููุทุงู**: ูุฑููู ุฏุงุฎู ุงูุดุฑูุฉ
- **ุงูุตูุงุญูุงุช**: ูุฑุงูุจุฉ ูุฅุฏุงุฑุฉ ุนูููุงุช ุงููุจูุนุงุช

### 4. Sales Agent (ูููู ุงููุจูุนุงุช)
- **ุงููุตู**: ุงูุชูุงุนู ุงููุจุงุดุฑ ูุน ุงูุนููุงุก ูุงูุตููุงุช
- **ุงููุทุงู**: ุจูุงูุงุชู ุงูุดุฎุตูุฉ ูุงููุนููุฉ ูู
- **ุงูุตูุงุญูุงุช**: ุฅุฏุงุฑุฉ ุนููุงุฆู ูุตููุงุชู ูุฃูุดุทุชู

### 5. Marketing (ุงูุชุณููู)
- **ุงููุตู**: ุฅุฏุงุฑุฉ ุงูุญููุงุช ุงูุชุณููููุฉ ูุฌุฐุจ ุงูุนููุงุก
- **ุงููุทุงู**: ุงูุญููุงุช ูุงูุนููุงุก ุงููุญุชูููู ุงูุชุณูููููู
- **ุงูุตูุงุญูุงุช**: ุฅุฏุงุฑุฉ ุงูุญููุงุช ูุชุญููู ุงูุจูุงูุงุช ุงูุชุณููููุฉ

### 6. Support (ุงูุฏุนู)
- **ุงููุตู**: ุชูุฏูู ุงูุฏุนู ุงูููู ูููุณุชุฎุฏููู
- **ุงููุทุงู**: ูุฑุงุกุฉ ููุท ูุจูุงูุงุช ุงูุดุฑูุฉ
- **ุงูุตูุงุญูุงุช**: ูุตูู ูููุฑุงุกุฉ ููุท ูุฃุบุฑุงุถ ุงูุฏุนู

## ๐ ูุตูููุฉ ุงูุตูุงุญูุงุช ุงูููุตูุฉ

### ุฑููุฒ ุงูุตูุงุญูุงุช:
- **C**: ุฅูุดุงุก (Create)
- **R**: ูุฑุงุกุฉ (Read)  
- **U**: ุชุญุฏูุซ (Update)
- **D**: ุญุฐู (Delete)
- **A**: ุชุนููู (Assign)
- **App**: ููุงููุฉ (Approve)

| ุงูููุงู / ุงูููุฒุฉ | Super Admin | Company Admin | Sales Manager | Sales Agent | Marketing | Support |
|:-----------------|:-----------:|:-------------:|:-------------:|:-----------:|:---------:|:-------:|
| **ุงููุณุชุฎุฏููู (Users)** | CRUD | CRUD (ุฏุงุฎู ุดุฑูุชู) | R (ูุฑููู) | R (ูููู) | R (ูููู) | R (ุดุฑูุชู) |
| **ุงูุดุฑูุงุช (Companies)** | CRUD | R, U (ุดุฑูุชู) | - | - | - | - |
| **ุงููุทูุฑูู (Developers)** | CRUD | CRUD (ุดุฑูุชู) | R | R | R | R |
| **ุงููุดุงุฑูุน (Projects)** | CRUD | CRUD (ุดุฑูุชู) | R | R | R | R |
| **ุงููุญุฏุงุช (Units)** | CRUD | CRUD (ุดุฑูุชู) | R | R | R | R |
| **ุงูุนููุงุก ุงููุญุชูููู (Leads)** | CRUD | R (ุดุฑูุชู) | R, U, A (ูุฑููู) | C, R, U (ุฎุงุต ุจู) | C, R, U (ุฎุงุต ุจู) | R (ุดุฑูุชู) |
| **ุงูุตููุงุช (Deals)** | CRUD | R (ุดุฑูุชู) | R, U, App (ูุฑููู) | C, R, U (ุฎุงุต ุจู) | R | R (ุดุฑูุชู) |
| **ุงูุฃูุดุทุฉ (Activities)** | CRUD | R (ุดุฑูุชู) | R (ูุฑููู), C,U,D (ุฎุงุต ุจู) | C, R, U, D (ุฎุงุต ุจู) | R | R (ุดุฑูุชู) |
| **ุงูุชูุงุฑูุฑ ูุงูุชุญูููุงุช (Reports & Analytics)** | R (ูุงูู) | R (ุดุฑูุชู) | R (ูุฑููู) | R (ุฎุงุต ุจู) | R | - |
| **ุงูุฅุนุฏุงุฏุงุช (Settings)** | R, U (ุนุงู) | R, U (ุดุฑูุชู) | - | - | R, U (ุชุณููู) | - |
| **AI Analysis** | R, U | R, U (ุดุฑูุชู) | R | R | R | - |
| **Marketing Campaigns** | R, U | R, U (ุดุฑูุชู) | - | - | C, R, U, D | - |
| **Payments & Subscriptions** | R, U | R, U (ุดุฑูุชู) | - | - | - | - |
| **Audit Logs** | R | R (ุดุฑูุชู) | - | - | - | - |

## ๐ง ุงูุตูุงุญูุงุช ุงูุฎุงุตุฉ ุงููุถุงูุฉ

### 1. ุตูุงุญูุงุช ุชุนููู ุงูุนููุงุก (Lead Assignment)
- **leads.assign**: ุชุนููู ุงูุนููุงุก ุงููุญุชูููู ููููุงุก ุงููุจูุนุงุช
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin, Sales Manager

### 2. ุตูุงุญูุงุช ุงูููุงููุฉ ุนูู ุงูุตููุงุช (Deal Approval)
- **deals.approve**: ุงูููุงููุฉ ุนูู ุงูุตููุงุช ูุจู ุงูุฅุบูุงู
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin, Sales Manager

### 3. ุตูุงุญูุงุช ุงูุญููุงุช ุงูุชุณููููุฉ (Marketing Campaigns)
- **campaigns.create**: ุฅูุดุงุก ุญููุงุช ุชุณููููุฉ ุฌุฏูุฏุฉ
- **campaigns.read**: ุนุฑุถ ุงูุญููุงุช ูุงูุฅุญุตุงุฆูุงุช
- **campaigns.update**: ุชุนุฏูู ุงูุญููุงุช ุงูููุฌูุฏุฉ
- **campaigns.delete**: ุญุฐู ุงูุญููุงุช
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin, Marketing

### 4. ุตูุงุญูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI Analysis)
- **ai.read**: ุนุฑุถ ุชุญูููุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- **ai.update**: ุชุญุฏูุซ ููุงุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin, Sales Manager, Sales Agent, Marketing

### 5. ุตูุงุญูุงุช ุงููุฏููุนุงุช (Payments)
- **payments.read**: ุนุฑุถ ุจูุงูุงุช ุงููุฏููุนุงุช ูุงูุงุดุชุฑุงูุงุช
- **payments.update**: ุชุญุฏูุซ ุญุงูุฉ ุงููุฏููุนุงุช
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin

### 6. ุตูุงุญูุงุช ุณุฌูุงุช ุงูุชุฏููู (Audit Logs)
- **audit.read**: ุนุฑุถ ุณุฌูุงุช ุงูุนูููุงุช ูุงูุชุฏููู
- **ุงููุชุงุญุฉ ูู**: Super Admin, Company Admin

## ๐ก๏ธ ุฃูุงู ูุณุชูู ุงูุตููู (Row-Level Security)

### Multi-tenant Isolation (ุนุฒู ุงูุจูุงูุงุช ุจูู ุงูุดุฑูุงุช)
- ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชุชุถูู ููุชุฑ `companyId = user.companyId`
- Super Admin ูู ุงููุญูุฏ ุงูุฐู ููููู ุชุฌุงูุฒ ูุฐุง ุงูููุฏ

### Role-based Data Filtering (ุชุตููุฉ ุงูุจูุงูุงุช ุญุณุจ ุงูุฏูุฑ)
- **Sales Agent**: ูุฑู ููุท ุงูุจูุงูุงุช ุงููุนููุฉ ูู ุฃู ุงูุชู ุฃูุดุฃูุง
  - `WHERE assignedTo = userId OR createdBy = userId`
- **Sales Manager**: ูุฑู ุจูุงูุงุช ูุฑููู
  - `WHERE managerId = userId OR userId IN (team_members)`
- **Marketing**: ูุฑู ุงูุนููุงุก ุงููุญุชูููู ูู ุงูุญููุงุช ุงูุชุณููููุฉ
  - `WHERE source = 'marketing' AND createdBy = userId`

## ๐ ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### โ ุชู ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ุงูุชุงููุฉ:
1. **ุงูุฅุดุนุงุฑุงุช (Notifications)**:
   - `notifications.read`, `notifications.create`, `notifications.update`, `notifications.delete`

2. **ุงููุฏููุนุงุช (Payments)**:
   - `payments.read`, `payments.create`, `payments.update`, `payments.delete`

3. **ุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI)**:
   - `ai.read`, `ai.create`, `ai.update`, `ai.delete`

4. **ุงูุญููุงุช ุงูุชุณููููุฉ (Campaigns)**:
   - `campaigns.read`, `campaigns.create`, `campaigns.update`, `campaigns.delete`

5. **ุงูุตูุงุญูุงุช ุงูุฎุงุตุฉ (Special Permissions)**:
   - `leads.assign` - ุชุนููู ุงูุนููุงุก ุงููุญุชูููู
   - `deals.approve` - ุงูููุงููุฉ ุนูู ุงูุตููุงุช
   - `audit.read` - ุนุฑุถ ุณุฌูุงุช ุงูุชุฏููู

### โ ุชู ุชุญุฏูุซ ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู:
- **Super Admin**: ุฌููุน ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ
- **Company Admin**: ุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ุดุงููุฉ ุฏุงุฎู ุงูุดุฑูุฉ
- **Sales Manager**: ุตูุงุญูุงุช ุงูุชุนููู ูุงูููุงููุฉ
- **Marketing**: ุตูุงุญูุงุช ุงูุญููุงุช ุงูุชุณููููุฉ ุงููุงููุฉ
- **Support**: ุชุญุฏูุซ ูููุตูู ูููุฑุงุกุฉ ููุท ูุฌููุน ุงูุจูุงูุงุช

## ๐ ูุซุงู ุนูู ุชุทุจูู ุงูุตูุงุญูุงุช

### ูู ุงูููุฏ (Backend)
```typescript
// ุชุนููู ุนููู ูุญุชูู ููููู ูุจูุนุงุช
@Post('leads/:id/assign')
@Permissions('leads.assign')
async assignLead(@Param('id') leadId: string, @Body() assignData: AssignLeadDto) {
  return this.leadsService.assignToAgent(leadId, assignData);
}

// ุงูููุงููุฉ ุนูู ุตููุฉ
@Post('deals/:id/approve') 
@Permissions('deals.approve')
async approveDeal(@Param('id') dealId: string) {
  return this.dealsService.approve(dealId);
}

// ุฅูุดุงุก ุญููุฉ ุชุณููููุฉ
@Post('campaigns')
@Permissions('campaigns.create')
async createCampaign(@Body() campaignData: CreateCampaignDto) {
  return this.campaignsService.create(campaignData);
}
```

### ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend)
```typescript
// ุฅุฎูุงุก ุฃุฒุฑุงุฑ ุจูุงุกู ุนูู ุงูุตูุงุญูุงุช
{hasPermission('leads.assign') && (
  <Button onClick={handleAssignLead}>ุชุนููู ููููู</Button>
)}

{hasPermission('deals.approve') && (
  <Button onClick={handleApprove}>ููุงููุฉ ุนูู ุงูุตููุฉ</Button>
)}

{hasPermission('campaigns.create') && (
  <Button onClick={handleCreateCampaign}>ุฅูุดุงุก ุญููุฉ</Button>
)}
```

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ**:
   - ุงุฎุชุจุงุฑ ูุญุฏุฉ ููุตูุงุญูุงุช ุงูุฎุงุตุฉ
   - ุงุฎุชุจุงุฑ ุชูุงูู ููู Row-Level Security

2. **ุชุญุฏูุซ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ**:
   - ุชุทุจูู ุงูุตูุงุญูุงุช ุงูุฌุฏูุฏุฉ ูู ุงูููููุงุช
   - ุฅุถุงูุฉ ูุงุฌูุงุช ุฅุฏุงุฑุฉ ุงูุญููุงุช ุงูุชุณููููุฉ

3. **ุชูุซูู ุดุงูู**:
   - ุฏููู ุงููุทูุฑ ููุตูุงุญูุงุช
   - ุฏููู ุงููุณุชุฎุฏู ููุฃุฏูุงุฑ

---

**ุขุฎุฑ ุชุญุฏูุซ**: ${new Date().toLocaleDateString('ar-SA')}
**ุงูุฅุตุฏุงุฑ**: 2.0.0
**ุงูุญุงูุฉ**: โ ููุทุจู